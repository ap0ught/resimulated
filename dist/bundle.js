!function(e){var n={};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)o.d(t,r,function(n){return e[n]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="",o(o.s=9)}([function(e,n,o){"use strict";o.r(n),n.default="#version 300 es\n\ninvariant gl_Position;\nin vec2 vert2d;\n\nvoid main(void) {\n  gl_Position = vec4(vert2d, 0, 1);\n}\n"},function(e,n,o){"use strict";o.r(n),n.default="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\nuniform vec3 iResolution;\nuniform float iTime;\n\n#define saturate(x) clamp(x, 0.0, 1.0)\n#define PI 3.14159265359\n#define PI2 6.28318530718\n#define EPS 0.0001\n\n#define BPM 120.0\n#define LEN 32.0\n#define _beat (iTime * BPM / 60.0)\n#define beat (mod(_beat, LEN))\n\nfloat sdRect(vec2 p, vec2 b) {\n    vec2 d = abs(p) - b;\n    return max(d.x, d.y) + min(max(d.x, d.y), 0.0);\n}\n\nmat2 rot(float x)\n{\n    return mat2(cos(x), sin(x), -sin(x), cos(x));\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n\treturn c.z * mix(K.xxx, saturate(p - K.xxx), c.y);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 p = (fragCoord.xy * 2.0 - iResolution.xy) / min(iResolution.x, iResolution.y);\n\n    // https://www.shadertoy.com/view/MdKfWR\n    vec2 q = p;\n    float d = 9999.0;\n    float z = PI2 * (beat + 16.0) / LEN;\n    for (int i = 0; i < 5; ++i) {\n        q = abs(q) - 0.5;\n        q *= rot(0.7);\n        q = abs(q) - 0.5;\n        q *= rot(z);\n        q *= 1.5;\n        float k = sdRect(q, vec2(0.5, 0.3 + q.x));\n        d = min(d, k);\n    }\n\n    float s = saturate(abs(0.2 / q.x));\n    vec3 col = hsv2rgb(vec3((beat + 16.0) / LEN, 1.0 - 0.6 * s, s)) * saturate(-2.0 * d);\n    col = pow(col * 2.0, vec3(2.0));\n    fragColor = vec4(col,1.0);\n}\n\nout vec4 outColor;\nvoid main( void ){vec4 color = vec4(0.0,0.0,0.0,1.0);mainImage( color, gl_FragCoord.xy );outColor = color;}"},function(e,n,o){"use strict";o.r(n),n.default="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\nuniform vec3 iResolution;\nuniform float iTime;\n\nuniform sampler2D iPrevPass;\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord / iResolution.xy;\n    fragColor = texture(iPrevPass, uv);\n}\n\nout vec4 outColor;\nvoid main( void ){vec4 color = vec4(0.0,0.0,0.0,1.0);mainImage( color, gl_FragCoord.xy );outColor = color;}"},function(e,n,o){"use strict";o.r(n),n.default="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\nuniform vec3 iResolution;\nuniform float iTime;\n\n// uniform sampler2D iPass0;\nuniform sampler2D iPrevPass;\n\nfloat brightness(vec3 c) {\n    return max(max(c.r, c.g), c.b);\n}\n\n// https://github.com/Unity-Technologies/PostProcessing/blob/v1/PostProcessing/Runtime/Components/BloomComponent.cs#L78-L109\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n    float softKnee = 0.5;\n    float lthresh = 0.8;\n\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec4 color = texture(iPrevPass, uv);\n    vec3 m = color.rgb;\n    float br = brightness(m);\n\n    float knee = lthresh * softKnee + 1e-5f;\n    vec3 curve = vec3(lthresh - knee, knee * 2.0, 0.25 / knee);\n    float rq = clamp(br - curve.x, 0.0, curve.y);\n    rq = curve.z * rq * rq;\n\n    m *= max(rq, br - lthresh) / max(br, 1e-5);\n    fragColor = vec4(m, color.a);\n}\n\nout vec4 outColor;\nvoid main( void ){vec4 color = vec4(0.0,0.0,0.0,1.0);mainImage( color, gl_FragCoord.xy );outColor = color;}"},function(e,n,o){"use strict";o.r(n),n.default="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\nuniform vec3 iResolution;\nuniform float iTime;\n\nuniform sampler2D iPrevPass;\n\nvec3 tap4(sampler2D tex, vec2 uv, vec2 texelSize)\n{\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);\n\n    vec3 s;\n    s = texture(tex, uv + d.xy).rgb;\n    s += texture(tex, uv + d.zy).rgb;\n    s += texture(tex, uv + d.xw).rgb;\n    s += texture(tex, uv + d.zw).rgb;\n\n    return s * (1.0 / 4.0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec2 texelSize = 1.0 / iResolution.xy;\n    fragColor = vec4(tap4(iPrevPass, uv, texelSize), 1.0);\n}\n\nout vec4 outColor;\nvoid main( void ){vec4 color = vec4(0.0,0.0,0.0,1.0);mainImage( color, gl_FragCoord.xy );outColor = color;}"},function(e,n,o){"use strict";o.r(n),n.default="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\nuniform vec3 iResolution;\nuniform float iTime;\n\nuniform sampler2D iPrevPass;\nuniform sampler2D iBeforeBloom;\nuniform sampler2D iPairBloomDown;\n\nvec3 tap4(sampler2D tex, vec2 uv, vec2 texelSize)\n{\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);\n\n    vec3 s;\n    s = texture(tex, uv + d.xy).rgb;\n    s += texture(tex, uv + d.zy).rgb;\n    s += texture(tex, uv + d.xw).rgb;\n    s += texture(tex, uv + d.zw).rgb;\n\n    return s * (1.0 / 4.0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec2 texelSize = 1.0 / iResolution.xy * 0.25;\n    vec3 col = texture(iPairBloomDown, uv).rgb;\n    fragColor = vec4(col + tap4(iPrevPass, uv, texelSize), 1.0);\n}\n\nout vec4 outColor;\nvoid main( void ){vec4 color = vec4(0.0,0.0,0.0,1.0);mainImage( color, gl_FragCoord.xy );outColor = color;}"},function(e,n,o){"use strict";o.r(n),n.default="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision mediump sampler3D;\nuniform vec3 iResolution;\nuniform float iTime;\n\nuniform sampler2D iPrevPass;\nuniform sampler2D iBeforeBloom;\nuniform sampler2D iPairBloomDown;\n\n#define saturate(x) clamp(x, 0.0, 1.0)\n\nvec3 tap4(sampler2D tex, vec2 uv, vec2 texelSize)\n{\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);\n\n    vec3 s;\n    s = texture(tex, uv + d.xy).rgb;\n    s += texture(tex, uv + d.zy).rgb;\n    s += texture(tex, uv + d.xw).rgb;\n    s += texture(tex, uv + d.zw).rgb;\n\n    return s * (1.0 / 4.0);\n}\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n\tvec2 uv = fragCoord.xy / iResolution.xy;\n    vec2 texelSize = 1.0 / iResolution.xy * 0.25;\n    vec3 col = texture(iBeforeBloom, uv).rgb;\n    vec3 pair = texture(iPairBloomDown, uv).rgb;\n    fragColor = vec4(col + pair + 10.0 * tap4(iPrevPass, uv, texelSize), 1.0);\n}\n\nout vec4 outColor;\nvoid main( void ){vec4 color = vec4(0.0,0.0,0.0,1.0);mainImage( color, gl_FragCoord.xy );outColor = color;}"},function(e,n,o){"use strict";o.r(n),n.default="#version 300 es\nprecision mediump float;\nuniform float iSampleRate;\nuniform float iBlockOffset;\n\n//--------------------\n// ここから下を書き換える\n//--------------------\n\n#define BPM 140.0\n\n#define PI 3.141592654\n#define TAU 6.283185307\n\n// ------\n// general functions\n\nfloat timeToBeat( float t ) { return t / 60.0 * BPM; }\nfloat beatToTime( float b ) { return b / BPM * 60.0; }\n\nfloat noteToFreq( float n ) {\n    return 440.0 * pow( 2.0, ( n - 69.0 ) / 12.0 );\n}\n\nfloat chord( float n ) {\n    return (\n        n < 1.0 ? 55.0 :\n        n < 2.0 ? 58.0 :\n        n < 3.0 ? 62.0 :\n                  65.0\n    );\n}\n\n// https://www.shadertoy.com/view/4djSRW\nvec4 noise( float p ) {\n    vec4 p4 = fract(vec4(p) * vec4(.1031, .1030, .0973, .1099));\n    p4 += dot(p4, p4.wzxy+33.33);\n    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n\n// ------\n// primitive oscillators\n\nfloat sine( float phase ) {\n    return sin( TAU * phase );\n}\n\nfloat saw( float phase ) {\n    return 2.0 * fract( phase ) - 1.0;\n}\n\nfloat square( float phase ) {\n    return fract( phase ) < 0.5 ? -1.0 : 1.0;\n}\n\n// ------\n// drums\n\nfloat kick( float time ) {\n    float amp = exp( -5.0 * time );\n    float phase = 50.0 * time\n                - 10.0 * exp( -70.0 * time );\n    return amp * sine( phase );\n}\n\nvec2 hihat( float time ) {\n    float amp = exp( -50.0 * time );\n    return amp * noise( time * 100.0 ).xy;\n}\n\n// ------\n// synths\n\nvec2 bass( float note, float time ) {\n    float freq = noteToFreq( note );\n    return vec2( square( freq * time ) + sine( freq * time ) ) / 2.0;\n}\n\nvec2 pad( float note, float time ) {\n    float freq = noteToFreq( note );\n    float vib = 0.2 * sine( 3.0 * time );\n    return vec2(\n        saw( freq * 0.99 * time + vib ),\n        saw( freq * 1.01 * time + vib )\n    );\n}\n\nvec2 arp( float note, float time ) {\n    float freq = noteToFreq( note );\n    float fmamp = 0.1 * exp( -50.0 * time );\n    float fm = fmamp * sine( time * freq * 7.0 );\n    float amp = exp( -20.0 * time );\n    return amp * vec2(\n        sine( freq * 0.99 * time + fm ),\n        sine( freq * 1.01 * time + fm )\n    );\n}\n\n// ------\n// main\n\nvec2 mainSound( float time ) {\n    float beat = timeToBeat( time );\n    vec2 ret = vec2( 0.0 );\n\n    // ---\n    // kick\n\n    float kickTime = beatToTime( mod( beat, 1.0 ) );\n    ret += 0.8 * kick( kickTime );\n\n    float sidechain = smoothstep( 0.0, 0.4, kickTime );\n\n    // ---\n    // hihat\n\n    float hihatTime = beatToTime( mod( beat + 0.5, 1.0 ) );\n    ret += 0.5 * hihat( hihatTime );\n\n    // ---\n    // bass\n\n    float bassNote = chord( 0.0 ) - 24.0;\n    ret += sidechain * 0.6 * bass( bassNote, time );\n\n    // ---\n    // chord\n\n    ret += sidechain * 0.6 * vec2(\n        pad( chord( 0.0 ), time )\n      + pad( chord( 1.0 ), time )\n      + pad( chord( 2.0 ), time )\n      + pad( chord( 3.0 ), time )\n    ) / 4.0;\n\n    // ---\n    // arp\n\n    float arpTime = beatToTime( mod( beat, 0.25 ) );\n    float[8] arpNotes = float[](\n        69.0, 70.0, 71.0, 72.0, 69.0, 70.0, 69.0, 72.0\n    );\n    float arpNote = arpNotes[int(mod(beat, 8.0))];\n\n    ret += sidechain * 0.5 * vec2( arp( arpNote, arpTime ) );\n\n    // ---\n\n    return clamp( ret, -1.0, 1.0 );\n}\n\n//--------------------\n// ここまでを書き換える\n//--------------------\n\nout vec4 outColor;\nvoid main()\n{\n    float t = iBlockOffset + ((gl_FragCoord.x - 0.5) + (gl_FragCoord.y - 0.5) * 512.0) / iSampleRate;\n    vec2 y = mainSound(t);\n    vec2 v = floor((0.5 + 0.5 * y) * 65536.0);\n    vec2 vl = mod(v, 256.0) / 255.0;\n    vec2 vh = floor(v / 256.0) / 255.0;\n    outColor = vec4(vl.x, vh.x, vl.y, vh.y);\n}"},function(e,n,o){"use strict";o.r(n),n.default="body{background-color:#000;margin:0;padding:0;color:#fff}canvas{display:block;position:absolute;top:0;left:0;right:0;bottom:0;margin:auto}#c{display:none}"},function(e,n,o){"use strict";var t;o.r(n),function(e){e[e.Image=0]="Image",e[e.FinalImage=1]="FinalImage",e[e.Bloom=2]="Bloom",e[e.BloomUpsample=3]="BloomUpsample",e[e.Sound=4]="Sound"}(t||(t={}));var r=function(){},i=512,a=512,l=function(){function e(e,n,o,l,u,s,f,c,m,v){var d=this;this.timeLength=e,this.isPlaying=!0,this.time=0;var p=this.audioContext=new window.AudioContext,x=document.createElement("canvas");x.width=window.innerWidth,x.height=window.innerHeight,window.document.body.appendChild(x);var g=this.gl=x.getContext("webgl2");if(g)if(g.getExtension("EXT_color_buffer_float"))if(g.getExtension("OES_texture_float_linear")){g.enable(g.CULL_FACE);var h=[[1,1],[-1,1],[1,-1],[-1,-1]],b=new Float32Array([].concat.apply([],h)),E=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,E),g.bufferData(g.ARRAY_BUFFER,b,g.STATIC_DRAW),g.bindBuffer(g.ARRAY_BUFFER,null);var R=[[0,1,2],[3,2,1]],T=new Uint16Array([].concat.apply([],R)),y=g.createBuffer();g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,y),g.bufferData(g.ELEMENT_ARRAY_BUFFER,T,g.STATIC_DRAW),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null);var P=g.createVertexArray(),_=function(e,n){var o=g.createShader(n);return g.shaderSource(o,e),g.compileShader(o),g.getShaderParameter(o,g.COMPILE_STATUS)||console.log(e,g.getShaderInfoLog(o)),o},B=function(e){var o=[_(n,g.VERTEX_SHADER),_(e,g.FRAGMENT_SHADER)],t=g.createProgram();return o.forEach((function(e){return g.attachShader(t,e)})),g.linkProgram(t),g.getProgramParameter(t,g.LINK_STATUS)||console.log(g.getProgramInfoLog(t)),t},C=function(e,n,o,i){!function(e){g.bindVertexArray(P),g.bindBuffer(g.ARRAY_BUFFER,E),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,y);var n=g.getAttribLocation(e,"vert2d"),o=g.FLOAT,t=h[0].length,r=t*Float32Array.BYTES_PER_ELEMENT;g.enableVertexAttribArray(n),g.vertexAttribPointer(n,t,o,!1,r,0),g.bindVertexArray(null)}(e);var a=new r;if(a.type=o,a.index=n,a.scale=i,a.program=e,a.uniforms={iResolution:{type:"v3",value:[x.width*a.scale,x.height*a.scale,0]},iTime:{type:"f",value:0},iPrevPass:{type:"t",value:Math.max(a.index-1,0)},iBeforeBloom:{type:"t",value:Math.max(l-1,0)},iBlockOffset:{type:"f",value:0},iSampleRate:{type:"f",value:p.sampleRate}},d.imagePasses.forEach((function(e,n){a.uniforms["iPass"+n]={type:"t",value:n}})),o===t.BloomUpsample){var s=n-(l+u);a.uniforms.iPairBloomDown={type:"t",value:n-2*s}}return a.locations=function(e){var n={};return Object.keys(e.uniforms).forEach((function(o){n[o]=g.getUniformLocation(e.program,o)})),n}(a),d.setupFrameBuffer(a),a},S=function(e){g.useProgram(e.program),g.bindFramebuffer(g.FRAMEBUFFER,e.frameBuffer),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);for(var n=0,o=Object.entries(e.uniforms);n<o.length;n++){var t=o[n],r=t[0],i=t[1];"t"===i.type&&0===r.indexOf("iPass")&&(g.activeTexture(g.TEXTURE0+i.value),g.bindTexture(g.TEXTURE_2D,d.imagePasses[i.value].texture)),{f:g.uniform1f,v3:g.uniform3fv,t:g.uniform1i}[i.type].call(g,e.locations[r],i.value)}g.bindVertexArray(P);var a=0*R[0].length;g.drawElements(g.TRIANGLES,T.length,g.UNSIGNED_SHORT,a);var l=g.getError();l!==g.NO_ERROR&&console.log(l),g.bindVertexArray(null),g.useProgram(null)};this.imagePasses=[];var F=0;o.forEach((function(e,n,o){if(n===l){d.imagePasses.push(C(B(s),F,t.Bloom,1)),F++;for(var r=1,i=0;i<u;i++)r*=.5,d.imagePasses.push(C(B(f),F,t.Bloom,r)),F++;for(i=0;i<u-1;i++)r*=2,d.imagePasses.push(C(B(c),F,t.BloomUpsample,r)),F++;d.imagePasses.push(C(B(m),F,t.BloomUpsample,1)),F++}d.imagePasses.push(C(B(e),F,n<o.length-1?t.Image:t.FinalImage,1)),F++}));for(var A=p.createBuffer(2,p.sampleRate*e,p.sampleRate),w=i*a,D=p.sampleRate*e/w,U=B(v),I=C(U,0,t.Sound,1),q=0;q<D;q++){I.uniforms.iBlockOffset.value=q*w/p.sampleRate,S(I);var L=new Uint8Array(i*a*4);g.readPixels(0,0,i,a,g.RGBA,g.UNSIGNED_BYTE,L);for(var N=A.getChannelData(0),z=A.getChannelData(1),M=0;M<w;M++)N[q*w+M]=(L[4*M+0]+256*L[4*M+1])/65535*2-1,z[q*w+M]=(L[4*M+2]+256*L[4*M+3])/65535*2-1}this.audioSource=p.createBufferSource(),this.audioSource.buffer=A,this.audioSource.loop=!0,this.audioSource.connect(p.destination);var O=0,k=0,X=function(e){requestAnimationFrame(X);var n=.001*(e-O);(d.isPlaying||k!==d.time)&&(d.imagePasses.forEach((function(e){e.uniforms.iTime.value=d.time,S(e)})),d.time+=n,k=d.time),O=e};X(0)}else alert("need OES_texture_float_linear");else alert("need EXT_color_buffer_float");else console.log("WebGL 2 is not supported...")}return e.prototype.setupFrameBuffer=function(e){if(e.type!==t.FinalImage){var n=this.gl,o=e.uniforms.iResolution.value[0],r=e.uniforms.iResolution.value[1],l=n.FLOAT,u=n.RGBA32F,s=n.LINEAR;e.type===t.Sound&&(o=i,r=a,l=n.UNSIGNED_BYTE,u=n.RGBA,s=n.NEAREST),e.frameBuffer=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,e.frameBuffer),e.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,e.texture),n.texImage2D(n.TEXTURE_2D,0,u,o,r,0,n.RGBA,l,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e.texture,0),n.bindTexture(n.TEXTURE_2D,null),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null)}},e.prototype.setSize=function(e,n){},e.prototype.stopSound=function(){this.audioSource.stop()},e.prototype.playSound=function(){var e=this.audioContext.createBufferSource();e.buffer=this.audioSource.buffer,e.loop=this.audioSource.loop,e.connect(this.audioContext.destination),this.audioSource=e,this.audioSource.start(this.audioContext.currentTime,this.time%this.timeLength)},e}();window.addEventListener("load",(function(e){new l(48,o(0).default,[o(1).default,o(2).default],1,3,o(3).default,o(4).default,o(5).default,o(6).default,o(7).default).playSound();var n=document.createElement("style");n.innerText=o(8).default,document.head.appendChild(n)}),!1)}]);